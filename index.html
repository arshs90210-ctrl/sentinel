<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldOS: Enterprise Sentinel Node</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            /* Enterprise Security Palette: Deep Navy, Gold (Audit), and Emerald (Safe) */
            --bg-dark: #0f172a;
            --panel: #1e293b;
            --border: #334155;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --accent: #f59e0b; /* Amber for "Security Alert" aesthetics */
            --safe: #10b981;
            --danger: #ef4444;
        }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .panel { background-color: var(--panel); border: 1px solid var(--border); }
        .input-dark { background-color: var(--bg-dark); border: 1px solid var(--border); color: var(--text-main); }
        .input-dark:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 1px var(--accent); }
        
        .redacted { background-color: var(--text-main); color: var(--text-main); border-radius: 2px; user-select: none; }
        .redacted:hover { background-color: var(--text-muted); color: var(--bg-dark); cursor: help; }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <script type="module">
        // Minimal Firebase Imports
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, collection, query, addDoc, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSy_dummy-api-key", authDomain: "dummy.firebaseapp.com", projectId: "dummy-project",
            storageBucket: "dummy.appspot.com", messagingSenderId: "123", appId: "1:123:web:abc"
        };
        
        // GLOBAL STATE
        let db; 
        const userId = 'ENT_ADMIN_001';
        let secureVault = []; // Local-only storage for demo

        // --- 1. THE 100K LOGIC: PII SCRUBBER ---
        const Sentinel = {
            patterns: {
                email: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,
                ssn: /\d{3}-\d{2}-\d{4}/g,
                creditCard: /\b\d{4}[- ]?\d{4}[- ]?\d{4}[- ]?\d{4}\b/g,
                currency: /\$\d{1,3}(,\d{3})*(\.\d{2})?/g,
                phone: /\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}/g
            },

            // The Core Value Function: Returns { original, clean, redactionCount }
            sanitize: async (text) => {
                let cleanText = text;
                let totalRedactions = 0;
                let riskScore = 0;

                // Simulate processing delay for "Analysis"
                await new Promise(r => setTimeout(r, 800));

                for (const [type, regex] of Object.entries(Sentinel.patterns)) {
                    const matches = text.match(regex);
                    if (matches) {
                        totalRedactions += matches.length;
                        riskScore += (matches.length * (type === 'ssn' || type === 'creditCard' ? 10 : 2)); // Weighted risk
                        cleanText = cleanText.replace(regex, `[REDACTED_${type.toUpperCase()}]`);
                    }
                }

                return {
                    original: text,
                    clean: cleanText,
                    stats: {
                        redactions: totalRedactions,
                        riskScore: Math.min(100, riskScore),
                        complianceStatus: riskScore > 0 ? 'SANITIZED' : 'CLEAN'
                    }
                };
            }
        };

        const App = window.App = {
            init: async () => {
                try {
                    const app = firebase.initializeApp(firebaseConfig);
                    db = firebase.getFirestore(app);
                    App.renderDashboard();
                } catch(e) { console.log("Firebase Simulated Mode"); }
                feather.replace();
            },

            ingestFile: async (input) => {
                const file = input.files[0];
                if (!file) return;

                // UI Feedback
                const btn = document.getElementById('upload-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = `<i data-feather="loader" class="animate-spin w-4 h-4 mr-2"></i> Scrubbing PII...`;
                feather.replace();

                const text = await file.text();
                
                // RUN THE SENTINEL ENGINE
                const result = await Sentinel.sanitize(text);
                
                const assetId = crypto.randomUUID().split('-')[0];
                const timestamp = new Date().toISOString();

                const asset = {
                    id: assetId,
                    name: file.name,
                    size: (file.size/1024).toFixed(2),
                    ...result,
                    timestamp
                };

                secureVault.unshift(asset);
                
                // Reset UI
                btn.innerHTML = originalText;
                feather.replace();
                input.value = '';

                // Log to Audit Trail
                App.logAudit(asset);
                App.renderDashboard();
                App.renderVault();
            },

            logAudit: (asset) => {
                const logs = document.getElementById('audit-log');
                const div = document.createElement('div');
                div.className = "flex justify-between items-center p-3 border-b border-border text-xs font-mono fade-in";
                div.innerHTML = `
                    <div>
                        <span class="text-accent font-bold">REQ_${asset.id}</span>
                        <span class="text-muted ml-2">Ingest & Sanitize</span>
                    </div>
                    <div class="text-right">
                        <span class="${asset.stats.riskScore > 0 ? 'text-safe' : 'text-muted'}">
                            ${asset.stats.riskScore > 0 ? `BLOCKED ${asset.stats.redactions} PII TOKENS` : 'NO THREATS FOUND'}
                        </span>
                    </div>
                `;
                logs.prepend(div);
            },

            renderDashboard: () => {
                // Calculate Stats
                const totalFiles = secureVault.length;
                const totalRedactions = secureVault.reduce((acc, cur) => acc + cur.stats.redactions, 0);
                const preventedFines = (totalRedactions * 2500).toLocaleString(); // $2500 per GDPR violation

                document.getElementById('stat-redactions').innerText = totalRedactions;
                document.getElementById('stat-fines').innerText = `$${preventedFines}`;
                document.getElementById('stat-files').innerText = totalFiles;
            },

            renderVault: () => {
                const container = document.getElementById('vault-grid');
                container.innerHTML = '';

                secureVault.forEach(asset => {
                    const card = document.createElement('div');
                    card.className = "panel rounded-lg p-5 fade-in";
                    
                    // Show raw snippet vs clean snippet logic
                    const snippet = asset.clean.substring(0, 150) + "...";
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-sm text-text-main flex items-center gap-2">
                                    <i data-feather="file-text" class="w-4 h-4 text-muted"></i> ${asset.name}
                                </h3>
                                <div class="mt-1 text-xs font-mono text-muted">ID: ${asset.id} â€¢ ${asset.size}KB</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs font-bold ${asset.stats.riskScore > 50 ? 'text-danger' : 'text-safe'} px-2 py-1 rounded bg-bg-dark border border-border">
                                    RISK: ${asset.stats.riskScore}/100
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-bg-dark p-3 rounded border border-border mb-4">
                            <div class="text-[10px] uppercase text-muted mb-1 font-bold tracking-wider">Sanitized Preview (Safe for LLM)</div>
                            <p class="text-xs font-mono text-text-muted leading-relaxed break-all">${snippet}</p>
                        </div>

                        <div class="flex justify-between items-center pt-3 border-t border-border">
                            <div class="flex gap-4 text-xs font-mono">
                                <span class="text-accent flex items-center gap-1"><i data-feather="shield" class="w-3 h-3"></i> ${asset.stats.redactions} Redacted</span>
                                <span class="text-safe flex items-center gap-1"><i data-feather="check-circle" class="w-3 h-3"></i> GDPR Ready</span>
                            </div>
                            <button class="text-xs bg-safe/10 text-safe hover:bg-safe/20 px-3 py-1.5 rounded transition-colors font-medium border border-safe/20">
                                Export Clean JSON
                            </button>
                        </div>
                    `;
                    container.appendChild(card);
                });
                feather.replace();
            }
        };

        window.onload = App.init;
    </script>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <nav class="h-16 border-b border-border bg-panel flex items-center justify-between px-6 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-accent/20 rounded flex items-center justify-center text-accent">
                <i data-feather="hexagon" class="w-5 h-5"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg tracking-tight">WorldOS <span class="text-accent">SENTINEL</span></h1>
                <p class="text-[10px] text-muted font-mono tracking-widest uppercase">Enterprise Data Governance Gateway</p>
            </div>
        </div>
        <div class="flex items-center gap-4 text-xs font-mono">
            <div class="flex items-center gap-2 text-safe">
                <span class="w-2 h-2 bg-safe rounded-full animate-pulse"></span> SYSTEM SECURE
            </div>
            <div class="px-3 py-1.5 rounded bg-bg-dark border border-border text-muted">
                ORG: ACME_CORP_GLOBAL
            </div>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-64 bg-bg-dark border-r border-border flex flex-col p-4 space-y-6 shrink-0">
            <div>
                <h3 class="text-xs font-bold text-muted uppercase tracking-wider mb-3">Governance</h3>
                <nav class="space-y-1">
                    <a href="#" class="flex items-center gap-3 px-3 py-2 rounded bg-panel border border-border text-sm font-medium text-accent">
                        <i data-feather="shield" class="w-4 h-4"></i> Data Sanitizer
                    </a>
                    <a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-muted hover:text-text-main text-sm font-medium transition-colors">
                        <i data-feather="activity" class="w-4 h-4"></i> Leakage Monitor
                    </a>
                    <a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-muted hover:text-text-main text-sm font-medium transition-colors">
                        <i data-feather="lock" class="w-4 h-4"></i> Vault Keys
                    </a>
                </nav>
            </div>

            <div class="flex-1 bg-panel rounded border border-border p-4 overflow-hidden flex flex-col">
                <h3 class="text-xs font-bold text-muted uppercase tracking-wider mb-3">Live Audit Log</h3>
                <div class="flex-1 overflow-y-auto space-y-0" id="audit-log">
                    </div>
            </div>
        </aside>

        <main class="flex-1 bg-bg-dark p-8 overflow-y-auto">
            
            <div class="grid grid-cols-3 gap-6 mb-8">
                <div class="panel p-6 rounded-lg shadow-lg relative overflow-hidden group">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                        <i data-feather="eye-off" class="w-16 h-16 text-accent"></i>
                    </div>
                    <div class="text-xs text-muted font-mono uppercase">PII Entities Redacted</div>
                    <div class="text-4xl font-bold mt-2 text-accent" id="stat-redactions">0</div>
                    <div class="text-xs text-muted mt-2">Sensitive tokens blocked from LLM</div>
                </div>
                
                <div class="panel p-6 rounded-lg shadow-lg relative overflow-hidden">
                    <div class="text-xs text-muted font-mono uppercase">Est. Liability Prevented</div>
                    <div class="text-4xl font-bold mt-2 text-safe" id="stat-fines">$0</div>
                    <div class="text-xs text-muted mt-2">Based on GDPR max violation metric</div>
                </div>

                <div class="panel p-6 rounded-lg shadow-lg flex flex-col justify-center items-center text-center border-dashed border-2 border-border cursor-pointer hover:border-accent hover:bg-panel transition-all">
                    <label class="cursor-pointer w-full h-full flex flex-col items-center justify-center">
                        <div id="upload-btn" class="flex items-center gap-2 text-sm font-bold text-text-main mb-1">
                            <i data-feather="upload-cloud" class="w-4 h-4"></i> Ingest & Scrub Data
                        </div>
                        <span class="text-xs text-muted">Supports PDF, TXT, CSV (Local Processing)</span>
                        <input type="file" class="hidden" onchange="App.ingestFile(this)">
                    </label>
                </div>
            </div>

            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i data-feather="database" class="w-5 h-5 text-accent"></i> Sanitized Asset Vault
            </h2>
            <div class="grid grid-cols-2 gap-6" id="vault-grid">
                <div class="col-span-2 py-12 text-center border border-dashed border-border rounded-lg text-muted">
                    <i data-feather="shield-off" class="w-8 h-8 mx-auto mb-3 opacity-50"></i>
                    <p class="text-sm">Vault Empty. Upload a document containing PII (emails, phone #, $$) to test the Sanitizer.</p>
                </div>
            </div>

        </main>
    </div>

</body>
</html>
